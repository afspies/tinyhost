<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>S3 Checkbox</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f4f4f9;
    }

    .container {
        background-color: white;
        padding: 30px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
    }

    label {
        font-size: 1.2em;
    }

    input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 10px;
    }

    .status {
        margin-top: 20px;
        font-size: 1.1em;
    }
</style>
<script>
    // BEGIN TINYHOST DATASTORE SECTION
    //
    // All the code in this block is autogenerated by tinyhost and added to your static html page
    // in order to support a simple datastore backed by AWS S3.
    // 
    // Please don't change anything here by hand
    // If it's not working, try running tinyhost again and getting a fresh link
    
    const datastoreId = "hYIZQKHenDEM6SAFxt1O";

    // Fetch state from the S3-backed datastore
    async function fetchDatastore() {
        try {
            const response = await fetch(presignedGetUrl);
            if (!response.ok) {
                throw new Error('Failed to fetch the file.');
            }
            return await response.json();
        } catch (error) {
            console.error('Error fetching tinyhost state from S3:', error);
        }
    }
    
    // Write data to the S3-backed datastore
    async function putDatastore(data) {
        try {
            // Create a FormData object to hold the necessary fields for the POST request
            const formData = new FormData();
    
            // Add fields provided by the presignedPostDict to the FormData object
            for (const [key, value] of Object.entries(presignedPostDict.fields)) {
                formData.append(key, value);
            }
    
            // Convert the data to JSON and append it as the file to be uploaded
            const jsonData = new Blob([JSON.stringify(data)], { type: 'application/json' });
            formData.append('file', jsonData);
    
            // Make the POST request to upload the data
            const response = await fetch(presignedPostDict.url, {
                method: 'POST',
                body: formData
            });
    
            if (!response.ok) {
                throw new Error('Failed to upload the file.');
            }
    
            console.log('Datastore successfully updated.');
        } catch (error) {
            console.error('Error putting tinyhost state to S3:', error);
        }
    }
    
    
    // END TINYHOST DATASTORE SECTION
</script>
</head>
<body>
<div class="container">
<label>
<input id="s3Checkbox" type="checkbox"/>
            S3 Stored Checkbox
        </label>
<div class="status" id="status">Loading status...</div>
</div>
<script>
        // Function to update the status text
        function updateStatus(checked) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = `Checkbox is ${checked ? 'checked' : 'unchecked'}`;
        }
    
        // Fetch the state and update the UI accordingly
        fetchDatastore().then(data => {
            const checkbox = document.getElementById('s3Checkbox');
    
            // If no data is present, initialize it
            if (!data.checked) {
                data = { checked: false };
            }
    
            // Update checkbox status based on datastore value
            checkbox.checked = data.checked;
            updateStatus(data.checked);
    
            // Add event listener to update datastore when checkbox is changed
            checkbox.addEventListener('change', () => {
                const isChecked = checkbox.checked;
                updateStatus(isChecked);
    
                // Update the datastore with the new checkbox state
                putDatastore({ checked: isChecked });
            });
        });
    </script>
</body>
</html>