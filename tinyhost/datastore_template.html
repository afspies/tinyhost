
// BEGIN TINYHOST DATASTORE SECTION
//
// All the code in this block is autogenerated by tinyhost and added to your static html page
// in order to support a simple datastore backed by AWS S3.
// 
// Please don't change anything here by hand
// If it's not working, try running tinyhost again and getting a fresh link

const datastoreId = "{{ datastore_id }}";
const presignedGetUrl = "{{ presigned_get_url }}";
const presignedPutUrl = "{{ presigned_put_url }}";


// Fetch state from the S3-backed datastore
async function fetchDatastore() {
    try {
        const response = await fetch(presignedGetUrl);
        if (!response.ok) {
            throw new Error('Failed to fetch the file.');
        }
        return await response.json();
    } catch (error) {
        console.error('Error fetching tinyhost state from S3:', error);
    }
}

// Put state back into the datastore
async function putDatastore(data) {
    try {
        const response = await fetch(presignedPutUrl, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),  // Convert the data to JSON format
        });

        if (!response.ok) {
            throw new Error('Failed to upload the file.');
        }

        console.log('Datastore successfully updated.');
    } catch (error) {
        console.error('Error uploading tinyhost state to S3:', error);
    }
}

// END TINYHOST DATASTORE SECTION 
